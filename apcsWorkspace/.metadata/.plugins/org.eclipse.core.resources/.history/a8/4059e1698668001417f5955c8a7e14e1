/*
Cody Brooks
2014-11-06
*/

public class AmericanSoundexReply {

	public static String getSoundex( String name ) {

		String soundex = "";

		name = name.toLowerCase();
		char[] nameCharList = name.toCharArray();

		//////////////////////////////////////////////////
		//
		// Fix 1: Flag the vowel letters to maintain the vowel letter positions
		//
		boolean[] vowelLs = new boolean[name.length()];
		for (int i = 0; i < nameCharList.length; i++) {
			vowelLs[i] = isVowel(nameCharList[i]);
		}

		/*Adds soundex values for all letters*/
		for (int i = 0; i < nameCharList.length; i++){
			// soundex += getSoundexVal(nameCharList[i]);
			String code = getSoundexVal(nameCharList[i]);
			
			////////////////////////////////////////////////
			//
			// Fix 2: Move the duplicate code logic inside the for loop so we refer to the same 
			// position i at the nameCharList and the isVowls arrays
			//
			if (code.length() == 0) {
				// retain the first vowel letter
				if (i == 0) {
					soundex += nameCharList[0];
				}
			} else {
				// check duplicate code
				if (soundex.length() > 0 
						&& soundex.substring(soundex.length() - 1, soundex.length()).equals(code)) {
					if (vowelLs[i-1]) {
						soundex += code;
					}
					
				} else {
					soundex += code;
				}
			}
		}
//		System.out.println("Raw soundex is " + soundex);

		// The positions of the soundex and vowels are no longer matched
		
		/*Remove duplicate numbers*/
/*		String newsoundex = "";
		char[] soundexList = soundex.toCharArray();

		for (int i = 0; i < soundex.length(); i++){
			if (newsoundex.length() > 0 && soundexList[i-1] == soundexList[i]) {
				// if (isVowel(soundexList[i-1])){
				if (isVowels[i-1]){
					newsoundex += soundexList[i];
				}
			} else {
				newsoundex += soundexList[i];
			}
		}

		soundex = newsoundex;
*/		
//		System.out.println("Un-truncated soundex is " + soundex);


		/*Replace the first character in the string with the first letter of the word*/
		soundex = nameCharList[0] + soundex.substring(1, soundex.length());

		if (soundex.length() < 4){
			/*Fill in with 0's*/
			for(int fillLen = 4 - soundex.length(); fillLen > 0; fillLen--){
				soundex += "0";
			}
		} else if (soundex.length() > 4){
			/*Truncate to 4 digits*/
			soundex = soundex.substring(0, 4);
		}


		soundex = soundex.toUpperCase();
		
		return soundex;

	}


	private static String getSoundexVal(char soundexChar){

		String soundexVal = "";

		if (soundexChar == 'a'
				|| soundexChar == 'e'
				|| soundexChar == 'i'
				|| soundexChar == 'o'
				|| soundexChar == 'u'
				|| soundexChar == 'y'
				|| soundexChar == 'h'
				|| soundexChar == 'w'){
			soundexVal = "";
		} else if (soundexChar == 'b'
				|| soundexChar == 'f'
				|| soundexChar == 'p'
				|| soundexChar == 'v'){
			soundexVal = "1";
		} else if (soundexChar == 'c'
				|| soundexChar == 'g'
				|| soundexChar == 'j'
				|| soundexChar == 'k'
				|| soundexChar == 'q'
				|| soundexChar == 's'
				|| soundexChar == 'x'
				|| soundexChar == 'z'){
			soundexVal = "2";
		} else if (soundexChar == 'd' || soundexChar == 't'){
			soundexVal = "3";
		} else if (soundexChar == 'l'){
			soundexVal = "4";
		} else if (soundexChar == 'm' || soundexChar == 'n'){
			soundexVal = "5";
		}else if (soundexChar == 'r'){
			soundexVal = "6";
		}

		return soundexVal;

	}


	private static boolean isVowel (char soundexChar) {
		
		boolean vowel;

		if (soundexChar == 'a'
				|| soundexChar == 'e'
				|| soundexChar == 'i'
				|| soundexChar == 'o'
				|| soundexChar == 'u'
				|| soundexChar == 'y'){
			vowel = true;
		} else {
			vowel = false;
		}

		return vowel;

	}

}